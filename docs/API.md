# Документация API Scrumno (Postman)

Базовый URL: `http://localhost:8080/api/v1` (порт задаётся в конфиге сервера).

Для защищённых ручек в заголовок **Authorization** нужно передавать: `Bearer <access_token>`.

---

## 1. Health — проверка подключения к БД

**Метод:** `GET`  
**URL:** `/api/v1/health/check-status-db-connect`  
**Авторизация:** требуется (Bearer access_token).

### Назначение

Проверяет, что приложение может подключиться к базе данных (используется `Ping()`).

### Заголовки

| Заголовок       | Значение           | Обязателен |
|-----------------|--------------------|------------|
| Authorization   | Bearer &lt;token&gt; | да         |

### Тело запроса

Не используется.

### Ответы

| Код | Описание |
|-----|----------|
| 200 | Подключение к БД успешно |
| 503 | Ошибка соединения с БД |

**Пример ответа 200:**
```json
{
  "message": "Подключение к базе данных - окей"
}
```

**Пример ответа 503:**
```json
{
  "message": "Не удалось установить соединение с БД"
}
```

---

## 2. Auth — вход (Login)

**Метод:** `POST`  
**URL:** `/api/v1/users/login`  
**Авторизация:** не требуется.

### Назначение

Вход по номеру телефона (username) и паролю. В ответ выдаются access_token и refresh_token.

### Заголовки

| Заголовок   | Значение          | Обязателен |
|-------------|-------------------|------------|
| Content-Type | application/json | да         |

### Тело запроса (JSON)

| Поле      | Тип    | Обязателен | Описание |
|-----------|--------|------------|----------|
| username  | string | да         | Номер телефона: 11 цифр, первая 7 (например `79996663355`) |
| password  | string | да         | Пароль пользователя |

**Пример тела:**
```json
{
  "username": "79996663355",
  "password": "your_password"
}
```

### Ответы

| Код | Описание |
|-----|----------|
| 200 | Успешный вход, возвращаются токены |
| 400 | Неверное тело запроса, пустые логин/пароль, неверный формат телефона или неверный логин/пароль |
| 500 | Ошибка при создании/сохранении токенов |

**Пример ответа 200:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIs...",
  "expires_in": "900"
}
```
`expires_in` — время жизни access-токена в секундах (900 = 15 минут).

**Пример ответа 400 (формат телефона):**
```json
{
  "message": "Номер телефона в формате 79996663355 (11 цифр, первая 7)"
}
```

**Пример ответа 400 (логин/пароль):**
```json
{
  "message": "Неверный логин или пароль"
}
```

---

## 3. Auth — регистрация (Signup)

**Метод:** `POST`  
**URL:** `/api/v1/users/signup`  
**Авторизация:** не требуется.

### Назначение

Регистрация нового пользователя по номеру телефона. После успешной регистрации возвращаются access_token и refresh_token.

### Заголовки

| Заголовок   | Значение          | Обязателен |
|-------------|-------------------|------------|
| Content-Type | application/json | да         |

### Тело запроса (JSON)

| Поле      | Тип    | Обязателен | Описание |
|-----------|--------|------------|----------|
| username  | string | да         | Номер телефона: 11 цифр, первая 7 |
| password  | string | да         | Пароль (обязателен) |
| full_name | string | нет        | Имя пользователя |

**Пример тела:**
```json
{
  "username": "79996663355",
  "password": "secret123",
  "full_name": "Иван Иванов"
}
```

### Ответы

| Код | Описание |
|-----|----------|
| 201 | Пользователь создан, возвращаются токены |
| 400 | Неверное тело, неверный формат телефона или пустой пароль |
| 409 | Пользователь с таким номером уже зарегистрирован |
| 500 | Ошибка создания пользователя или выдачи токенов |

**Пример ответа 201:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIs...",
  "expires_in": "900"
}
```

**Пример ответа 409:**
```json
{
  "message": "Пользователь с таким номером телефона уже зарегистрирован"
}
```

---

## 4. Auth — обновление токенов (Refresh)

**Метод:** `POST`  
**URL:** `/api/v1/users/refresh`  
**Авторизация:** не требуется (передаётся refresh_token в теле).

### Назначение

Обмен действующего refresh_token на новую пару access_token и refresh_token. Старый refresh_token после успешного обмена инвалидируется.

### Заголовки

| Заголовок   | Значение          | Обязателен |
|-------------|-------------------|------------|
| Content-Type | application/json | да         |

### Тело запроса (JSON)

| Поле          | Тип    | Обязателен | Описание |
|---------------|--------|------------|----------|
| refresh_token | string | да         | Текущий refresh-токен |

**Пример тела:**
```json
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIs..."
}
```

### Ответы

| Код | Описание |
|-----|----------|
| 200 | Токены обновлены, возвращается новая пара |
| 400 | Тело неверное, refresh_token не передан или передан не refresh-токен |
| 401 | Токен невалидный, истёкший или отозван (не найден в БД) |
| 500 | Ошибка при создании или сохранении новых токенов |

**Пример ответа 200:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIs...",
  "expires_in": "900"
}
```

**Пример ответа 401:**
```json
{
  "message": "Невалидный или истёкший refresh токен"
}
```

```json
{
  "message": "Refresh токен отозван или не найден"
}
```

---

## 5. Users — список всех пользователей

**Метод:** `GET`  
**URL:** `/api/v1/users`  
**Авторизация:** требуется (Bearer access_token).

### Назначение

Возвращает список всех пользователей. Поле `password` в ответ не включается.

### Заголовки

| Заголовок     | Значение           | Обязателен |
|---------------|--------------------|------------|
| Authorization | Bearer &lt;token&gt; | да         |

### Тело запроса

Не используется.

### Ответы

| Код | Описание |
|-----|----------|
| 200 | Успех, массив пользователей |
| 401 | Нет заголовка Authorization или неверный формат |
| 403 | Невалидный токен или передан refresh вместо access |
| 500 | Ошибка БД |

**Пример ответа 200:**
```json
[
  {
    "id": 1,
    "username": "79996663355",
    "full_name": "Иван Иванов",
    "created_at": "2025-02-15T12:00:00Z",
    "updated_at": "2025-02-15T12:00:00Z"
  }
]
```

---

## 6. Users — пользователь по ID

**Метод:** `GET`  
**URL:** `/api/v1/users/{id}`  
**Авторизация:** требуется (Bearer access_token).

### Назначение

Возвращает одного пользователя по числовому ID. Поле `password` не возвращается.

### Path-параметры

| Параметр | Тип   | Описание |
|----------|-------|----------|
| id       | number | ID пользователя (целое положительное) |

**Пример URL:** `/api/v1/users/1`

### Заголовки

| Заголовок     | Значение           | Обязателен |
|---------------|--------------------|------------|
| Authorization | Bearer &lt;token&gt; | да         |

### Тело запроса

Не используется.

### Ответы

| Код | Описание |
|-----|----------|
| 200 | Успех, объект пользователя |
| 400 | ID не передан или некорректный (не число) |
| 401 | Нет или неверный заголовок Authorization |
| 403 | Невалидный или не access-токен |
| 404 | Пользователь с таким ID не найден |
| 500 | Ошибка БД (при запросе по ID обычно не возвращается) |

**Пример ответа 200:**
```json
{
  "id": 1,
  "username": "79996663355",
  "full_name": "Иван Иванов",
  "created_at": "2025-02-15T12:00:00Z",
  "updated_at": "2025-02-15T12:00:00Z"
}
```

**Пример ответа 404:**
```json
{
  "message": "Пользователь не найден"
}
```

---

## Импорт коллекции в Postman

1. В Postman: **File → Import** (или Import в левой панели).
2. Выберите файл: `docs/postman/Scrumno-API.postman_collection.json`.
3. В коллекции заданы переменные:
   - `baseUrl` — по умолчанию `http://localhost:8080`;
   - `access_token` и `refresh_token` — заполняются автоматически после Login/Signup/Refresh (скрипты в разделе **Auth**).

Рекомендуемый порядок проверки в Postman: **Login** или **Signup** → затем запросы **Health** и **Users** с подставленным `access_token`.
